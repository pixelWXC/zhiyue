# Story 3-1: 卡片生成服务 - 手动测试清单

## 📋 测试准备

- [ ] 确保已配置有效的 Gemini API Key（在设置中）
- [ ] 浏览器扩展已成功加载
- [ ] Side Panel 可以正常打开
- [ ] 开发者控制台已打开（用于查看日志）

---

## 🧪 测试用例

### ✅ TC-1: 基本功能 - 简单句子

**前置条件**: API Key 已配置

**测试步骤**:
1. 在测试面板输入句子: `猫がりんごを食べる`
2. 目标词汇输入: `食べる`
3. 点击"生成卡片"按钮

**预期结果**:
- [ ] 显示"生成中"状态
- [ ] 3-10秒内生成完成
- [ ] 所有字段都有内容：
  - [ ] targetWord: `食べる`
  - [ ] reading: 假名形式（如 `たべる`）
  - [ ] sentence: 原句子
  - [ ] meaning: 简洁的中文含义
  - [ ] hint: 有意义的学习提示
  - [ ] sceneDescription: 英文描述
- [ ] sceneDescription 包含以下关键词之一：
  - [ ] "minimalist" 或 "sketch"
  - [ ] "doodle" 或 "hand-drawn"
  - [ ] "white background"
- [ ] 无错误信息

**实际结果**: _____________

**状态**: ⬜ 通过 / ⬜ 失败

---

### ✅ TC-2: 无目标词汇 - AI 自动选择

**测试步骤**:
1. 输入句子: `私は学校へ行きます`
2. 目标词汇留空
3. 点击"生成卡片"

**预期结果**:
- [ ] AI 自动选择一个核心词汇（通常是动词/名词/形容词）
- [ ] 生成的 targetWord 是句子中的某个词
- [ ] 其他字段正常生成

**实际结果**: _____________

**状态**: ⬜ 通过 / ⬜ 失败

---

### ✅ TC-3: 错误处理 - 空句子

**测试步骤**:
1. 句子输入框留空或只输入空格
2. 点击"生成卡片"

**预期结果**:
- [ ] 按钮应该被禁用（disabled）或
- [ ] 不执行任何操作
- [ ] 不发送 API 请求

**实际结果**: _____________

**状态**: ⬜ 通过 / ⬜ 失败

---

### ✅ TC-4: 错误处理 - 无效 API Key

**测试步骤**:
1. 清除或填写错误的 API Key
2. 尝试生成卡片

**预期结果**:
- [ ] 显示错误信息: "未配置 API Key，请先在设置中配置" 或类似提示
- [ ] cardError 状态被正确设置
- [ ] isGeneratingCard 恢复为 false

**实际结果**: _____________

**状态**: ⬜ 通过 / ⬜ 失败

---

### ✅ TC-5: 复杂句子测试

**测试步骤**:
1. 输入复杂句子: `昨日友達と一緒に映画を見に行きました`
2. 目标词汇: `見る`
3. 生成卡片

**预期结果**:
- [ ] 成功生成
- [ ] reading 包含正确的假名（`みる`）
- [ ] sentence 完整保留原句
- [ ] meaning 准确且简洁
- [ ] hint 提供实用信息（如语法点、常见搭配等）
- [ ] sceneDescription 描述符合情境

**实际结果**: _____________

**状态**: ⬜ 通过 / ⬜ 失败

---

### ✅ TC-6: 场景描述质量检查

**测试步骤**:
1. 生成多张卡片（至少 3 张不同句子）
2. 检查每张卡片的 sceneDescription

**预期结果 - 每个 sceneDescription 应该**:
- [ ] 使用英文编写
- [ ] 包含关键风格词（minimalist/sketch/doodle/hand-drawn/white）
- [ ] 描述具体场景（人物、物体、动作）
- [ ] 长度合理（不过短或过长，大约 1-3 句话）
- [ ] 创意有趣，能帮助记忆

**示例好的描述**:
```
A minimalist hand-drawn sketch on white background: 
A cheerful girl sitting at a simple table, eating an 
apple with a big smile. Doodle-style lines with 
minimal details, warm and friendly atmosphere.
```

**实际结果**: _____________

**状态**: ⬜ 通过 / ⬜ 失败

---

### ✅ TC-7: 状态管理 - 连续生成

**测试步骤**:
1. 生成第一张卡片（句子 A）
2. 不刷新页面，立即生成第二张卡片（句子 B）
3. 再生成第三张（句子 C）

**预期结果**:
- [ ] 每次生成都正确清除之前的 cardError
- [ ] cardData 正确更新为最新生成的卡片
- [ ] 不会显示旧数据
- [ ] isGeneratingCard 状态正确切换

**实际结果**: _____________

**状态**: ⬜ 通过 / ⬜ 失败

---

### ✅ TC-8: 性能测试

**测试步骤**:
1. 记录生成卡片的时间
2. 测试至少 5 次
3. 计算平均响应时间

**预期结果**:
- [ ] 平均响应时间 < 10 秒（Flash 模型）
- [ ] 95% 的请求在 15 秒内完成
- [ ] 无超时错误

**测试数据**:
| 次数 | 响应时间 | 状态 |
|------|---------|------|
| 1    | ___ 秒  | ___  |
| 2    | ___ 秒  | ___  |
| 3    | ___ 秒  | ___  |
| 4    | ___ 秒  | ___  |
| 5    | ___ 秒  | ___  |

**平均**: ___ 秒

**状态**: ⬜ 通过 / ⬜ 失败

---

### ✅ TC-9: JSON 格式验证

**测试步骤**:
1. 生成一张卡片
2. 在控制台中输入: `console.log(JSON.stringify(useAiStore().cardData, null, 2))`
3. 检查 JSON 结构

**预期结果**:
```json
{
  "targetWord": "...",
  "reading": "...",
  "sentence": "...",
  "meaning": "...",
  "hint": "...",
  "sceneDescription": "..."
}
```

- [ ] 所有字段都是字符串类型
- [ ] 无 undefined 字段
- [ ] 无额外的未知字段
- [ ] JSON 可以被 `JSON.parse()` 解析

**实际结果**: _____________

**状态**: ⬜ 通过 / ⬜ 失败

---

### ✅ TC-10: clearResults 功能

**测试步骤**:
1. 生成一张卡片
2. 在控制台输入: `useAiStore().clearResults()`
3. 检查状态

**预期结果**:
- [ ] cardData 变为 null
- [ ] cardError 变为 null
- [ ] isGeneratingCard 变为 false
- [ ] 界面正确更新（卡片显示消失）

**实际结果**: _____________

**状态**: ⬜ 通过 / ⬜ 失败

---

## 📊 测试总结

**总用例数**: 10  
**通过数**: ___  
**失败数**: ___  
**通过率**: ___%

### 🐛 发现的问题

1. _______________________________________
2. _______________________________________
3. _______________________________________

### ✨ 改进建议

1. _______________________________________
2. _______________________________________
3. _______________________________________

---

## 🔍 深度验证测试（可选）

### 多语言场景
- [ ] 测试长句子（20+ 字符）
- [ ] 测试单个词汇
- [ ] 测试包含特殊字符的句子（「」、。、！等）
- [ ] 测试混合假名和汉字的句子

### 边缘情况
- [ ] 网络断开时的行为
- [ ] API 速率限制错误处理
- [ ] 超长句子（100+ 字符）
- [ ] 特殊格式的目标词汇（如 "～ている"）

### 兼容性
- [ ] Chrome 浏览器
- [ ] Edge 浏览器
- [ ] 不同分辨率下的 UI 显示

---

**测试人员**: ___________  
**测试日期**: ___________  
**环境**: 开发环境 / 生产环境
